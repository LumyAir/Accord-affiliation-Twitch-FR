!function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)__webpack_require__.d(n,o,function(t){return e[t]}.bind(null,o));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="//cdn.frankerfacez.com/static/addons/",__webpack_require__(__webpack_require__.s=77)}({77:function(e,t){const{Mutex:n}=FrankerFaceZ.utilities.object;function get(e){return fetch("https://pronouns.alejo.io/api/"+e).then(e=>e.json())}class Pronouns extends FrankerFaceZ.utilities.addon.Addon{constructor(...e){super(...e),this.inject("chat"),this.inject("chat.badges"),this.inject("i18n"),this.inject("settings"),this.waiting=new n(4),this.pronouns={},this.users=new Map}async onLoad(){await this.loadPronouns()}onEnable(){this.settings.add("addon.pronouns.color",{default:"",ui:{path:"Add-Ons > Pronouns >> Appearance",title:"Badge Color",component:"setting-color-box"},changed:()=>this.updateBadges()}),this.settings.add("addon.pronouns.border",{default:!0,ui:{path:"Add-Ons > Pronouns >> Appearance",title:"Display a border around the badge.",component:"setting-check-box"},changed:()=>this.updateBadges()}),this.buildBadges();const e=this.onMessage.bind(this);this.chat.addTokenizer({type:"pronouns",process:e}),this.emit("chat:update-lines")}onMessage(e,t){const n=null==t?void 0:t.user,o=null==n?void 0:n.login;if(o){const e=this.getUser(o);e instanceof Promise&&e.then(e=>{e&&(this.chat.getUser(n.id,o).addBadge("pronouns","addon-pn-"+e),this.emit("chat:update-lines-by-user",n.id,o,!1,!0))})}return e}getUser(e,t=!1){const n=this.users.get(e);if(n){if(!n.done)return t?new Promise((e,t)=>n.promises.push([e,t])):null;if(Date.now()<=n.time+3e5)return n.value}return new Promise((t,n)=>{this.users.set(e,{done:!1,promises:[[t,n]]}),this.waiting.wait().then(t=>Promise.all([t,get("users/"+e)])).then(([t,n])=>{let o=!1;if(Array.isArray(n))for(const t of n){t.login===e&&(o=!0);const n=this.users.get(t.login);if(n&&(n.done=!0,n.value=t.pronoun_id,n.time=Date.now(),n.promises)){for(const e of n.promises)e[0](n.value);n.promises=null}}if(!o){const t=this.users.get(e);if(t&&(t.done=!0,t.value=null,t.time=Date.now(),t.promises)){for(const e of t.promises)e[0](t.value);t.promises=null}}t()})})}async loadPronouns(){const e=await get("pronouns");if(this.pronouns={},Array.isArray(e))for(const t of e)this.pronouns[t.name]=t.display}buildBadges(){const e=this.old_badges;for(const[t,n]of Object.entries(this.pronouns))e&&e.has(t)?e.delete(t):this.updateBadge(t,n,!1);if(e)for(const t of e)this.badges.loadBadgeData("addon-pn-"+t,void 0,!1);this.old_badges=new Set(Object.keys(this.pronouns)),this.badges.buildBadgeCSS()}updateBadge(e,t,n=!1){let o="display:inline-flex;align-items:center;";this.settings.get("addon.pronouns.border")&&(o+="border:0.1rem solid;border-radius:0.5rem");const s="addon.pronouns.color."+e;this.old_badges&&this.old_badges.has(e)||this.settings.add(s,{default:null,requires:["addon.pronouns.color"],process:(e,t)=>null==t?e.get("addon.pronouns.color"):t,ui:{path:"Add-Ons > Pronouns >> Per-Badge Colors",title:t,i18n_key:null,component:"setting-color-box",force_seen:!0},changed:()=>{this.pronouns[e]&&this.updateBadge(e,t,!0)}}),this.badges.loadBadgeData("addon-pn-"+e,{content:t,title:this.i18n.t("addon.pronouns.title","Pronouns: {value}",{value:t}),click_url:"https://pronouns.alejo.io/",color:this.settings.get(s),slot:100,css:o},n)}updateBadges(){for(const[e,t]of Object.entries(this.pronouns))this.updateBadge(e,t);this.badges.buildBadgeCSS()}}Pronouns.register("pronouns")}});
//# sourceMappingURL=script.aa32e2b26e42c0045038.js.map